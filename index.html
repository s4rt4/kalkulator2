<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalkulator Sederhana</title>
  <style>
    :root{
      --bg:#0f1115;
      --panel:#171a21;
      --text:#e7e9ee;
      --muted:#9aa3b2;
      --accent:#4f8cff;
      --op:#2a2f3a;
      --op-active:#3a4150;
      --key:#1f2430;
      --key-active:#2b3240;
      --danger:#e23b3b;
      --ok:#21b66f;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 10% 10%, #131827, #0b0d13 60%);
      color:var(--text);
      display:flex; align-items:center; justify-content:center; padding:20px;
    }
    .calculator{
      width:min(420px, 100%);
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      border:1px solid #1f2430;
    }
    .display{
      padding:18px 16px 8px;
      background:linear-gradient(180deg,#141823,#12151f);
      border-bottom:1px solid #1f2430;
    }
    .status{
      font-size:12px; color:var(--muted);
      display:flex; justify-content:space-between; gap:8px; opacity:.85;
      user-select:none;
    }
    .screen{
      margin-top:6px;
      font-weight:600;
      font-variant-numeric: tabular-nums;
      word-wrap:break-word;
      word-break:break-all;
      text-align:right;
      line-height:1.2;
    }
    .prev{
      font-size:16px; color:var(--muted); min-height:1.2em;
    }
    .curr{
      font-size:40px; letter-spacing:.5px; min-height:1.2em;
    }

    .keys{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      padding:14px;
      background:var(--panel);
    }
    button.key{
      appearance:none; border:none; outline:none;
      border-radius:14px;
      padding:18px 14px;
      font-size:18px; font-weight:600;
      background:var(--key);
      color:var(--text);
      box-shadow: inset 0 -2px 0 rgba(255,255,255,.03);
      touch-action:manipulation;
      min-height:56px; /* touch target */
      transition: transform .05s ease, background .15s ease, filter .15s ease;
    }
    button.key:active{ transform: translateY(1px); filter:brightness(1.05); }
    .key.wide{ grid-column: span 2; }
    .key.op{ background:var(--op); }
    .key.op:active{ background:var(--op-active); }
    .key.equals{ background:var(--accent); color:white; }
    .key.equals:active{ filter:brightness(0.95); }
    .key.danger{ background:var(--danger); color:white; }
    .key.util{ background:var(--key); color:#cfe0ff; }

    /* Accessibility focus */
    .key:focus-visible{ outline:2px solid #7aa2ff; outline-offset:2px }

    /* Small devices */
    @media (max-width:370px){
      .curr{ font-size:34px }
      button.key{ min-height:52px; padding:16px 12px; font-size:17px }
    }
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Calculator">
    <section class="display" aria-live="polite" aria-atomic="true">
      <div class="status">
        <span id="status-mode">Standard</span>
        <span id="status-info">Local only</span>
      </div>
      <div class="screen">
        <div class="prev" id="prev"> </div>
        <div class="curr" id="curr">0</div>
      </div>
    </section>

    <section class="keys">
      <!-- Row 1 -->
      <button class="key danger" data-action="clear" aria-label="Clear">CLEAR</button>
      <button class="key util" data-action="backspace" aria-label="Backspace">⌫</button>
      <button class="key util" data-action="sqrt" aria-label="Square Root">√</button>
      <button class="key util" data-action="percent" aria-label="Percent">%</button>
      <button class="key op" data-op="÷" aria-label="Divide">÷</button>

      <!-- Row 2 -->
      <button class="key" data-num="7">7</button>
      <button class="key" data-num="8">8</button>
      <button class="key" data-num="9">9</button>
      <button class="key op" data-op="×" aria-label="Multiply">×</button>

      <!-- Row 3 -->
      <button class="key" data-num="4">4</button>
      <button class="key" data-num="5">5</button>
      <button class="key" data-num="6">6</button>
      <button class="key op" data-op="-" aria-label="Subtract">−</button>

      <!-- Row 4 -->
      <button class="key" data-num="1">1</button>
      <button class="key" data-num="2">2</button>
      <button class="key" data-num="3">3</button>
      <button class="key op" data-op="+" aria-label="Add">+</button>

      <!-- Row 5 -->
      <button class="key util" data-action="sign">±</button>
      <button class="key" data-num="0">0</button>
      <button class="key" data-action="dot">.</button>
      <button class="key equals wide" data-action="equals" aria-label="Equals">=</button>
    </section>
  </main>

  <script>
    const prevEl = document.getElementById('prev');
    const currEl = document.getElementById('curr');

    let curr = '0';
    let prev = '';
    let op = null;
    let justEvaluated = false;

    const format = (nStr) => {
      // keep as string; format integer part with grouping, preserve decimals
      if (nStr === '' || nStr === '-') return nStr || '0';
      if (nStr === '.') return '0.';
      const n = Number(nStr);
      if (!isFinite(n)) return 'Error';
      const [i, d] = nStr.split('.');
      const iFmt = Number(i).toLocaleString(undefined);
      return d !== undefined ? `${iFmt}.${d}` : iFmt;
    };

    const updateScreen = () => {
      currEl.textContent = format(curr);
      prevEl.textContent = prev ? `${format(prev)} ${op ?? ''}` : ' ';
    };

    const inputNum = (d) => {
      if (justEvaluated) { curr = '0'; justEvaluated = false; }
      if (curr.length >= 20) return;
      if (curr === '0') curr = d;
      else curr += d;
      updateScreen();
    };

    const setOp = (newOp) => {
      if (op && prev !== '' && curr !== '' && !justEvaluated) {
        evaluate(); // chain ops
      }
      prev = curr;
      curr = '0';
      op = newOp;
      justEvaluated = false;
      updateScreen();
    };

    const dot = () => {
      if (justEvaluated) { curr = '0'; justEvaluated = false; }
      if (!curr.includes('.')) curr += '.';
      updateScreen();
    };

    const sign = () => {
      if (curr === '0') return;
      curr = curr.startsWith('-') ? curr.slice(1) : '-' + curr;
      updateScreen();
    };

    const percent = () => {
      const n = Number(curr);
      curr = (n / 100).toString();
      updateScreen();
    };

    const sqrt = () => {
  const n = Number(curr);
  if (n < 0) {
    curr = "Error";  // tidak bisa akar bilangan negatif
  } else {
    curr = Math.sqrt(n).toString();
  }
  updateScreen();
};


    const backspace = () => {
      if (justEvaluated) return;
      curr = curr.length > 1 ? curr.slice(0, -1) : '0';
      updateScreen();
    };

    const clearAll = () => {
      curr = '0'; prev = ''; op = null; justEvaluated = false;
      updateScreen();
    };

    const evaluate = () => {
      if (op === null || prev === '' ) return;
      const a = Number(prev), b = Number(curr);
      let result;
      switch (op) {
        case '+': result = a + b; break;
        case '-': result = a - b; break;
        case '×': result = a * b; break;
        case '÷': result = b === 0 ? NaN : a / b; break;
      }
      curr = isFinite(result) ? `${+result}` : 'Error';
      prev = '';
      op = null;
      justEvaluated = true;
      updateScreen();
    };

    // Event delegation for clicks/taps
    document.querySelector('.keys').addEventListener('click', (e) => {
      const btn = e.target.closest('button.key');
      if (!btn) return;

      const num = btn.getAttribute('data-num');
      const opSym = btn.getAttribute('data-op');
      const action = btn.getAttribute('data-action');

      if (num) inputNum(num);
      else if (opSym) setOp(opSym);
      else if (action === 'dot') dot();
      else if (action === 'sign') sign();
      else if (action === 'percent') percent();
      else if (action === 'sqrt') sqrt();
      else if (action === 'backspace') backspace();
      else if (action === 'clear') clearAll();
      else if (action === 'equals') evaluate();
    });

    // Keyboard support
    window.addEventListener('keydown', (e) => {
      const k = e.key;
      if (/\d/.test(k)) inputNum(k);
      else if (k === '.' || k === ',') dot();
      else if (k === 'Backspace') backspace();
      else if (k === 'Escape') clearAll();
      else if (k === 'Enter' || k === '=') evaluate();
      else if (k === '+' || k === '-' || k === '*' || k === '/' ) {
        setOp(k.replace('*','×').replace('/','÷'));
      }
    });

    // Initial render
    updateScreen();
  </script>
</body>
</html>
